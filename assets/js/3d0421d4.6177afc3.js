"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[765],{756:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>a,frontMatter:()=>i,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"documents/servers/sse_server_guide","title":"SSE Server","description":"\u6982\u8ff0","source":"@site/docs/documents/servers/sse_server_guide.md","sourceDirName":"documents/servers","slug":"/documents/servers/sse_server_guide","permalink":"/llmbrick/docs/documents/servers/sse_server_guide","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"documentsSidebar","previous":{"title":"gRPC Server","permalink":"/llmbrick/docs/documents/servers/grpc_server_guide"}}');var l=s(4848),d=s(8453);const i={},t="SSE Server",c={},o=[{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:2},{value:"\u7279\u8272\u529f\u80fd",id:"\u7279\u8272\u529f\u80fd",level:2},{value:"\u5feb\u901f\u958b\u59cb",id:"\u5feb\u901f\u958b\u59cb",level:2},{value:"\u57fa\u672c\u4f7f\u7528",id:"\u57fa\u672c\u4f7f\u7528",level:3},{value:"\u4f7f\u7528\u914d\u7f6e\u985e\u5225",id:"\u4f7f\u7528\u914d\u7f6e\u985e\u5225",level:3},{value:"SSE Server \u985e\u5225\u53c3\u6578\u8207\u64cd\u4f5c\u8aaa\u660e",id:"sse-server-\u985e\u5225\u53c3\u6578\u8207\u64cd\u4f5c\u8aaa\u660e",level:2},{value:"SSE Server \u5efa\u69cb\u5b50\u53c3\u6578",id:"sse-server-\u5efa\u69cb\u5b50\u53c3\u6578",level:3},{value:"\u53c3\u6578\u4e92\u52d5\u8207\u6ce8\u610f\u4e8b\u9805",id:"\u53c3\u6578\u4e92\u52d5\u8207\u6ce8\u610f\u4e8b\u9805",level:4},{value:"\u53c3\u6578\u5be6\u4f8b\u8207\u64cd\u4f5c\u7bc4\u4f8b",id:"\u53c3\u6578\u5be6\u4f8b\u8207\u64cd\u4f5c\u7bc4\u4f8b",level:3},{value:"1. \u8a2d\u5b9a\u81ea\u8a02 API \u8def\u5f91\u8207\u524d\u7db4",id:"1-\u8a2d\u5b9a\u81ea\u8a02-api-\u8def\u5f91\u8207\u524d\u7db4",level:4},{value:"2. \u8a3b\u518a\u4e3b handler\uff08\u5169\u7a2e\u65b9\u5f0f\uff09",id:"2-\u8a3b\u518a\u4e3b-handler\u5169\u7a2e\u65b9\u5f0f",level:4},{value:"3. \u555f\u7528\u6e2c\u8a66\u9801\u9762",id:"3-\u555f\u7528\u6e2c\u8a66\u9801\u9762",level:4},{value:"4. \u4f7f\u7528\u81ea\u5b9a\u7fa9\u9a57\u8b49\u5668",id:"4-\u4f7f\u7528\u81ea\u5b9a\u7fa9\u9a57\u8b49\u5668",level:4},{value:"\u64cd\u4f5c\u6d41\u7a0b\u8207\u5e38\u898b\u554f\u984c",id:"\u64cd\u4f5c\u6d41\u7a0b\u8207\u5e38\u898b\u554f\u984c",level:3},{value:"\u8def\u5f91\u7d44\u5408\u898f\u5247",id:"\u8def\u5f91\u7d44\u5408\u898f\u5247",level:4},{value:"Handler \u8a2d\u5b9a\u5931\u6557",id:"handler-\u8a2d\u5b9a\u5931\u6557",level:4},{value:"\u6e2c\u8a66\u9801\u9762\u6a21\u677f\u907a\u5931",id:"\u6e2c\u8a66\u9801\u9762\u6a21\u677f\u907a\u5931",level:4},{value:"\u81ea\u5b9a\u7fa9\u9a57\u8b49\u5668\u932f\u8aa4",id:"\u81ea\u5b9a\u7fa9\u9a57\u8b49\u5668\u932f\u8aa4",level:4},{value:"\u9032\u968e\uff1aSSE Server \u4e3b\u8981\u65b9\u6cd5",id:"\u9032\u968esse-server-\u4e3b\u8981\u65b9\u6cd5",level:3},{value:"\u5e38\u898b\u932f\u8aa4\u8207\u6392\u9664",id:"\u5e38\u898b\u932f\u8aa4\u8207\u6392\u9664",level:3},{value:"\u5be6\u7528\u5efa\u8b70",id:"\u5be6\u7528\u5efa\u8b70",level:3},{value:"API \u53c3\u8003",id:"api-\u53c3\u8003",level:2},{value:"SSEServerConfig",id:"sseserverconfig",level:3},{value:"\u8acb\u6c42\u683c\u5f0f",id:"\u8acb\u6c42\u683c\u5f0f",level:3},{value:"ConversationSSERequest \u6b04\u4f4d\u8aaa\u660e",id:"conversationsserequest-\u6b04\u4f4d\u8aaa\u660e",level:4},{value:"Message \u6b04\u4f4d\u8aaa\u660e",id:"message-\u6b04\u4f4d\u8aaa\u660e",level:4},{value:"\u7bc4\u4f8b JSON",id:"\u7bc4\u4f8b-json",level:4},{value:"\u56de\u61c9\u683c\u5f0f",id:"\u56de\u61c9\u683c\u5f0f",level:3},{value:"ConversationSSEResponse \u6b04\u4f4d\u8aaa\u660e",id:"conversationsseresponse-\u6b04\u4f4d\u8aaa\u660e",level:4},{value:"SSEContext \u6b04\u4f4d\u8aaa\u660e",id:"ssecontext-\u6b04\u4f4d\u8aaa\u660e",level:4},{value:"SSEResponseMetadata \u6b04\u4f4d\u8aaa\u660e",id:"sseresponsemetadata-\u6b04\u4f4d\u8aaa\u660e",level:4},{value:"\u7bc4\u4f8b JSON",id:"\u7bc4\u4f8b-json-1",level:4},{value:"\u9a57\u8b49\u6a5f\u5236",id:"\u9a57\u8b49\u6a5f\u5236",level:2},{value:"\u8f38\u5165\u9a57\u8b49",id:"\u8f38\u5165\u9a57\u8b49",level:3},{value:"\u8f38\u51fa\u9a57\u8b49",id:"\u8f38\u51fa\u9a57\u8b49",level:3},{value:"\u932f\u8aa4\u8655\u7406",id:"\u932f\u8aa4\u8655\u7406",level:2},{value:"HTTP \u932f\u8aa4\u78bc",id:"http-\u932f\u8aa4\u78bc",level:3},{value:"SSE \u932f\u8aa4\u4e8b\u4ef6",id:"sse-\u932f\u8aa4\u4e8b\u4ef6",level:3},{value:"\u81ea\u5b9a\u7fa9\u7570\u5e38",id:"\u81ea\u5b9a\u7fa9\u7570\u5e38",level:3},{value:"\u958b\u767c\u8005\u4f7f\u7528\u6a21\u5f0f",id:"\u958b\u767c\u8005\u4f7f\u7528\u6a21\u5f0f",level:2},{value:"1. \u57fa\u672c\u804a\u5929\u6a5f\u5668\u4eba",id:"1-\u57fa\u672c\u804a\u5929\u6a5f\u5668\u4eba",level:3},{value:"2. \u6d41\u5f0f\u56de\u61c9",id:"2-\u6d41\u5f0f\u56de\u61c9",level:3},{value:"3. \u6574\u5408\u5916\u90e8 LLM",id:"3-\u6574\u5408\u5916\u90e8-llm",level:3},{value:"\u5167\u5efa\u6e2c\u8a66\u9801\u9762",id:"\u5167\u5efa\u6e2c\u8a66\u9801\u9762",level:2},{value:"\u6e2c\u8a66\u4f60\u7684\u61c9\u7528",id:"\u6e2c\u8a66\u4f60\u7684\u61c9\u7528",level:2},{value:"\u4f7f\u7528 curl \u6e2c\u8a66",id:"\u4f7f\u7528-curl-\u6e2c\u8a66",level:3},{value:"\u6e2c\u8a66\u4f60\u7684 Handler",id:"\u6e2c\u8a66\u4f60\u7684-handler",level:3},{value:"JavaScript \u5ba2\u6236\u7aef\u6e2c\u8a66",id:"javascript-\u5ba2\u6236\u7aef\u6e2c\u8a66",level:3},{value:"\u6545\u969c\u6392\u9664",id:"\u6545\u969c\u6392\u9664",level:2},{value:"\u5e38\u898b\u554f\u984c",id:"\u5e38\u898b\u554f\u984c",level:3},{value:"\u9664\u932f\u6a21\u5f0f",id:"\u9664\u932f\u6a21\u5f0f",level:3},{value:"\u6700\u4f73\u5be6\u8e10",id:"\u6700\u4f73\u5be6\u8e10",level:2},{value:"\u9032\u968e\u529f\u80fd",id:"\u9032\u968e\u529f\u80fd",level:2},{value:"\u81ea\u5b9a\u7fa9\u9a57\u8b49\u5668",id:"\u81ea\u5b9a\u7fa9\u9a57\u8b49\u5668",level:3},{value:"\u66f4\u7c21\u55ae\u7684\u9a57\u8b49\u5668\u64f4\u5c55",id:"\u66f4\u7c21\u55ae\u7684\u9a57\u8b49\u5668\u64f4\u5c55",level:3},{value:"\u4e2d\u9593\u4ef6\u652f\u63f4",id:"\u4e2d\u9593\u4ef6\u652f\u63f4",level:3}];function h(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"sse-server",children:"SSE Server"})}),"\n",(0,l.jsx)(n.h2,{id:"\u6982\u8ff0",children:"\u6982\u8ff0"}),"\n",(0,l.jsx)(n.p,{children:"LLMBrick SSE Server \u662f\u4e00\u500b\u57fa\u65bc FastAPI \u7684 Server-Sent Events (SSE) \u670d\u52d9\u5668\uff0c\u5c08\u70ba\u5927\u578b\u8a9e\u8a00\u6a21\u578b\u5c0d\u8a71\u61c9\u7528\u8a2d\u8a08\u3002\u5b83\u63d0\u4f9b\u4e86\u5b8c\u6574\u7684\u578b\u614b\u5b89\u5168\u3001\u932f\u8aa4\u8655\u7406\u548c\u958b\u767c\u8005\u53cb\u5584\u7684\u914d\u7f6e\u9078\u9805\u3002"}),"\n",(0,l.jsx)(n.h2,{id:"\u7279\u8272\u529f\u80fd",children:"\u7279\u8272\u529f\u80fd"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u2705 ",(0,l.jsx)(n.strong,{children:"\u5b8c\u6574\u7684\u578b\u614b\u5b89\u5168\u4fdd\u969c"})," - \u56b4\u683c\u7684\u8f38\u5165\u8f38\u51fa\u9a57\u8b49"]}),"\n",(0,l.jsxs)(n.li,{children:["\u2705 ",(0,l.jsx)(n.strong,{children:"\u696d\u52d9\u908f\u8f2f\u9a57\u8b49"})," - \u53ef\u914d\u7f6e\u7684\u6a21\u578b\u6e05\u55ae\u3001\u8a0a\u606f\u9577\u5ea6\u9650\u5236\u7b49"]}),"\n",(0,l.jsxs)(n.li,{children:["\u2705 ",(0,l.jsx)(n.strong,{children:"\u7d50\u69cb\u5316\u932f\u8aa4\u8655\u7406"})," - \u8a73\u7d30\u7684\u932f\u8aa4\u8a0a\u606f\u548c\u7570\u5e38\u8655\u7406"]}),"\n",(0,l.jsxs)(n.li,{children:["\u2705 ",(0,l.jsx)(n.strong,{children:"\u958b\u767c\u8005\u53cb\u5584"})," - \u53ef\u914d\u7f6e\u7684\u9664\u932f\u6a21\u5f0f\u548c\u65e5\u8a8c\u8a18\u9304"]}),"\n",(0,l.jsxs)(n.li,{children:["\u2705 ",(0,l.jsx)(n.strong,{children:"\u5411\u5f8c\u76f8\u5bb9"})," - \u652f\u63f4\u73fe\u6709\u7684\u521d\u59cb\u5316\u65b9\u5f0f"]}),"\n",(0,l.jsxs)(n.li,{children:["\u2705 ",(0,l.jsx)(n.strong,{children:"\u6613\u65bc\u6e2c\u8a66"})," - \u63d0\u4f9b\u6e2c\u8a66\u5de5\u5177\u548c\u7bc4\u4f8b\u5e6b\u52a9\u958b\u767c\u8005\u9a57\u8b49\u61c9\u7528"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u5feb\u901f\u958b\u59cb",children:"\u5feb\u901f\u958b\u59cb"}),"\n",(0,l.jsx)(n.h3,{id:"\u57fa\u672c\u4f7f\u7528",children:"\u57fa\u672c\u4f7f\u7528"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'from llmbrick.servers.sse.server import SSEServer\nfrom llmbrick.protocols.models.http.conversation import ConversationSSEResponse, ConversationSSERequest\n\n# \u5275\u5efa SSE Server\nserver = SSEServer()\n\n# \u5b9a\u7fa9\u8655\u7406\u51fd\u6578\n@server.handler\nasync def my_handler(request_data: ConversationSSERequest):\n    """\n    request_data: ConversationSSERequest\n    """\n    # \u8655\u7406\u908f\u8f2f\n    yield ConversationSSEResponse(\n        id="msg-1",\n        type="text",\n        text="Hello World",\n        progress="IN_PROGRESS"\n    )\n    \n    yield ConversationSSEResponse(\n        id="msg-2",\n        type="done",\n        progress="DONE"\n    )\n\n# \u555f\u52d5\u670d\u52d9\u5668\nserver.run(host="0.0.0.0", port=8000)\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u4f7f\u7528\u914d\u7f6e\u985e\u5225",children:"\u4f7f\u7528\u914d\u7f6e\u985e\u5225"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'from llmbrick.servers.sse.server import SSEServer\nfrom llmbrick.servers.sse.config import SSEServerConfig\n\n# \u5275\u5efa\u914d\u7f6e\nconfig = SSEServerConfig(\n    host="127.0.0.1",\n    port=9000,\n    debug_mode=True,\n    allowed_models=["gpt-4o", "claude-3"],\n    max_message_length=5000,\n    enable_request_logging=True\n)\n\n# \u4f7f\u7528\u914d\u7f6e\u5275\u5efa\u670d\u52d9\u5668\nserver = SSEServer(config=config)\n\n@server.handler\nasync def advanced_handler(request_data: ConversationSSERequest):\n    """\n    request_data: ConversationSSERequest\n    """\n    # \u914d\u7f6e\u6703\u81ea\u52d5\u9a57\u8b49\u8acb\u6c42\n    # \u696d\u52d9\u908f\u8f2f\u8655\u7406...\n    pass\n\nserver.run()\n'})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"sse-server-\u985e\u5225\u53c3\u6578\u8207\u64cd\u4f5c\u8aaa\u660e",children:"SSE Server \u985e\u5225\u53c3\u6578\u8207\u64cd\u4f5c\u8aaa\u660e"}),"\n",(0,l.jsx)(n.h3,{id:"sse-server-\u5efa\u69cb\u5b50\u53c3\u6578",children:"SSE Server \u5efa\u69cb\u5b50\u53c3\u6578"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"SSEServer(\n    handler: Optional[Callable[[ConversationSSERequest], AsyncGenerator[ConversationSSEResponse, None]]] = None,\n    config: Optional[SSEServerConfig] = None,\n    chat_completions_path: Optional[str] = None,\n    prefix: Optional[str] = None,\n    custom_validator: Optional[Any] = None,\n    enable_test_page: bool = False,\n)\n"})}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u53c3\u6578\u540d\u7a31"}),(0,l.jsx)(n.th,{children:"\u985e\u578b/\u9810\u8a2d\u503c"}),(0,l.jsx)(n.th,{children:"\u8aaa\u660e"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"handler"})}),(0,l.jsx)(n.td,{children:"Callable/None"}),(0,l.jsxs)(n.td,{children:["\u4e3b SSE \u8655\u7406\u51fd\u6578\uff0c\u5fc5\u9808\u70ba async generator\uff0c\u8ca0\u8cac\u8655\u7406\u6bcf\u500b\u8acb\u6c42\u4e26 yield ",(0,l.jsx)(n.code,{children:"ConversationSSEResponse"}),"\u3002\u53ef\u7528\u88dd\u98fe\u5668\u6216 set_handler \u8a2d\u5b9a\u3002"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"config"})}),(0,l.jsx)(n.td,{children:"SSEServerConfig/None"}),(0,l.jsx)(n.td,{children:"\u4f3a\u670d\u5668\u8a2d\u5b9a\u7269\u4ef6\uff0c\u8a73\u7d30\u53c3\u898b\u4e0b\u65b9\u300cSSEServerConfig\u300d\u3002\u672a\u63d0\u4f9b\u6642\u6703\u81ea\u52d5\u5efa\u7acb\u9810\u8a2d\u8a2d\u5b9a\u3002"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"chat_completions_path"})}),(0,l.jsx)(n.td,{children:"str/None"}),(0,l.jsxs)(n.td,{children:["API \u8def\u5f91\uff08\u820a\u7248\u76f8\u5bb9\uff09\uff0c\u5982 ",(0,l.jsx)(n.code,{children:"/chat/completions"}),"\u3002\u82e5\u6709\u8a2d\u5b9a\u6703\u8986\u84cb config \u5167\u5c0d\u61c9\u6b04\u4f4d\u3002"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"prefix"})}),(0,l.jsx)(n.td,{children:"str/None"}),(0,l.jsxs)(n.td,{children:["API \u8def\u5f91\u524d\u7db4\uff08\u820a\u7248\u76f8\u5bb9\uff09\uff0c\u5982 ",(0,l.jsx)(n.code,{children:"/api"}),"\u3002\u82e5\u6709\u8a2d\u5b9a\u6703\u8986\u84cb config \u5167\u5c0d\u61c9\u6b04\u4f4d\u3002"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"custom_validator"})}),(0,l.jsx)(n.td,{children:"Any/None"}),(0,l.jsxs)(n.td,{children:["\u81ea\u5b9a\u7fa9\u9a57\u8b49\u5668\uff0c\u9700\u5be6\u4f5c ",(0,l.jsx)(n.code,{children:"validate(request, ...)"})," \u975c\u614b\u65b9\u6cd5\u3002\u53ef\u7528\u65bc\u7279\u6b8a\u696d\u52d9\u9a57\u8b49\u3002"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"enable_test_page"})}),(0,l.jsx)(n.td,{children:"bool/False"}),(0,l.jsxs)(n.td,{children:["\u662f\u5426\u555f\u7528\u5167\u5efa\u6e2c\u8a66\u9801\u9762\uff08\u50c5\u958b\u767c/\u6e2c\u8a66\u7528\uff09\u3002\u555f\u7528\u5f8c\u53ef\u65bc ",(0,l.jsx)(n.code,{children:"/"})," \u8def\u5f91\u5b58\u53d6\u4e92\u52d5\u6e2c\u8a66\u9801\u3002"]})]})]})]}),"\n",(0,l.jsx)(n.h4,{id:"\u53c3\u6578\u4e92\u52d5\u8207\u6ce8\u610f\u4e8b\u9805",children:"\u53c3\u6578\u4e92\u52d5\u8207\u6ce8\u610f\u4e8b\u9805"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"config"}),"\u3001",(0,l.jsx)(n.code,{children:"chat_completions_path"}),"\u3001",(0,l.jsx)(n.code,{children:"prefix"})," \u6703\u4e92\u76f8\u8986\u84cb\uff0c\u512a\u5148\u9806\u5e8f\u70ba\uff1a\u5efa\u69cb\u5b50\u53c3\u6578 > config \u7269\u4ef6 > \u9810\u8a2d\u503c\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"handler"})," \u53ef\u65bc\u521d\u59cb\u5316\u6642\u50b3\u5165\uff0c\u4e5f\u53ef\u5f8c\u7e8c\u7528 ",(0,l.jsx)(n.code,{children:"@server.handler"})," \u88dd\u98fe\u5668\u6216 ",(0,l.jsx)(n.code,{children:"set_handler()"})," \u8a2d\u5b9a\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"custom_validator"})," \u82e5\u6709\u8a2d\u5b9a\uff0c\u6703\u53d6\u4ee3\u9810\u8a2d\u9a57\u8b49\u5668\uff0c\u65bc\u6bcf\u6b21\u8acb\u6c42\u6642\u9032\u884c\u696d\u52d9\u9a57\u8b49\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"enable_test_page=True"})," \u6642\uff0c\u9700\u78ba\u4fdd ",(0,l.jsx)(n.code,{children:"llmbrick/servers/sse/templates/test_page.html"})," \u5b58\u5728\uff0c\u5426\u5247\u6703\u6709\u8b66\u544a\u3002"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"\u53c3\u6578\u5be6\u4f8b\u8207\u64cd\u4f5c\u7bc4\u4f8b",children:"\u53c3\u6578\u5be6\u4f8b\u8207\u64cd\u4f5c\u7bc4\u4f8b"}),"\n",(0,l.jsx)(n.h4,{id:"1-\u8a2d\u5b9a\u81ea\u8a02-api-\u8def\u5f91\u8207\u524d\u7db4",children:"1. \u8a2d\u5b9a\u81ea\u8a02 API \u8def\u5f91\u8207\u524d\u7db4"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'server = SSEServer(\n    prefix="/api/v1",\n    chat_completions_path="/mychat"\n)\n# API \u5be6\u969b\u8def\u5f91\u70ba /api/v1/mychat\n'})}),"\n",(0,l.jsx)(n.h4,{id:"2-\u8a3b\u518a\u4e3b-handler\u5169\u7a2e\u65b9\u5f0f",children:"2. \u8a3b\u518a\u4e3b handler\uff08\u5169\u7a2e\u65b9\u5f0f\uff09"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u5efa\u69cb\u5b50\u50b3\u5165\uff1a"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'async def my_handler(request_data: ConversationSSERequest):\n    """\n    request_data: ConversationSSERequest\n    """\n    yield ConversationSSEResponse(...)\nserver = SSEServer(handler=my_handler)\n'})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u88dd\u98fe\u5668\u8a3b\u518a\uff1a"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'server = SSEServer()\n@server.handler\nasync def my_handler(request_data: ConversationSSERequest):\n    """\n    request_data: ConversationSSERequest\n    """\n    yield ConversationSSEResponse(...)\n'})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"3-\u555f\u7528\u6e2c\u8a66\u9801\u9762",children:"3. \u555f\u7528\u6e2c\u8a66\u9801\u9762"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"server = SSEServer(enable_test_page=True)\n# \u555f\u52d5\u5f8c\u53ef\u65bc http://localhost:8000/ \u4e92\u52d5\u6e2c\u8a66\n"})}),"\n",(0,l.jsx)(n.h4,{id:"4-\u4f7f\u7528\u81ea\u5b9a\u7fa9\u9a57\u8b49\u5668",children:"4. \u4f7f\u7528\u81ea\u5b9a\u7fa9\u9a57\u8b49\u5668"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'class MyValidator:\n    @staticmethod\n    def validate(request, allowed_models=None, max_message_length=10000, max_messages_count=100):\n        # \u57fa\u672c\u9a57\u8b49\n        ...\n        # \u81ea\u8a02\u898f\u5247\n        if request.temperature > 2.0:\n            raise ValidationException("Temperature too high")\n\nserver = SSEServer(custom_validator=MyValidator())\n'})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"\u64cd\u4f5c\u6d41\u7a0b\u8207\u5e38\u898b\u554f\u984c",children:"\u64cd\u4f5c\u6d41\u7a0b\u8207\u5e38\u898b\u554f\u984c"}),"\n",(0,l.jsx)(n.h4,{id:"\u8def\u5f91\u7d44\u5408\u898f\u5247",children:"\u8def\u5f91\u7d44\u5408\u898f\u5247"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"prefix"})," \u8207 ",(0,l.jsx)(n.code,{children:"chat_completions_path"})," \u6703\u81ea\u52d5\u88dc\u9f4a ",(0,l.jsx)(n.code,{children:"/"}),"\uff0c\u907f\u514d\u91cd\u8907\u6216\u907a\u6f0f\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:["\u4f8b\u5982\uff1a",(0,l.jsx)(n.code,{children:'prefix="/api"'}),", ",(0,l.jsx)(n.code,{children:'chat_completions_path="chat"'})," \u2192 \u5be6\u969b\u8def\u5f91\u70ba ",(0,l.jsx)(n.code,{children:"/api/chat"})]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"handler-\u8a2d\u5b9a\u5931\u6557",children:"Handler \u8a2d\u5b9a\u5931\u6557"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u82e5\u672a\u8a2d\u5b9a handler\uff0cAPI \u6703\u56de\u50b3 404 \u932f\u8aa4\u3002"}),"\n",(0,l.jsx)(n.li,{children:"\u6e2c\u8a66\u9801\u9762\u6703\u986f\u793a\u8b66\u544a\uff1a\u300cNo handler is configured. Requests will fail until a handler is set.\u300d"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"\u6e2c\u8a66\u9801\u9762\u6a21\u677f\u907a\u5931",children:"\u6e2c\u8a66\u9801\u9762\u6a21\u677f\u907a\u5931"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u82e5 ",(0,l.jsx)(n.code,{children:"test_page.html"})," \u4e0d\u5b58\u5728\uff0c\u555f\u52d5\u6642\u6703\u6709 logger \u8b66\u544a\uff0c\u4f46\u4e0d\u5f71\u97ff\u4e3b API \u904b\u4f5c\u3002"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"\u81ea\u5b9a\u7fa9\u9a57\u8b49\u5668\u932f\u8aa4",children:"\u81ea\u5b9a\u7fa9\u9a57\u8b49\u5668\u932f\u8aa4"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u82e5\u9a57\u8b49\u5668\u672a\u6b63\u78ba\u5be6\u4f5c ",(0,l.jsx)(n.code,{children:"validate"})," \u975c\u614b\u65b9\u6cd5\uff0c\u8acb\u6c42\u6703\u76f4\u63a5\u5931\u6557\uff0c\u5efa\u8b70\u53c3\u8003\u9810\u8a2d\u9a57\u8b49\u5668\u5be6\u4f5c\u3002"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"\u9032\u968esse-server-\u4e3b\u8981\u65b9\u6cd5",children:"\u9032\u968e\uff1aSSE Server \u4e3b\u8981\u65b9\u6cd5"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"set_handler(func)"}),"\uff1a\u76f4\u63a5\u8a2d\u5b9a\u4e3b handler\uff0c\u6703\u81ea\u52d5\u91cd\u8a2d\u8def\u7531\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"handler(func)"}),"\uff1a\u88dd\u98fe\u5668\u7528\u6cd5\uff0c\u8a3b\u518a\u4e3b handler\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"run(host=None, port=None)"}),"\uff1a\u555f\u52d5\u4f3a\u670d\u5668\uff0chost/port \u53ef\u8986\u84cb config \u8a2d\u5b9a\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"fastapi_app"}),"\uff1a\u53d6\u5f97\u5e95\u5c64 FastAPI app\uff0c\u53ef\u7528\u65bc\u8a3b\u518a\u4e2d\u9593\u4ef6\u6216\u81ea\u8a02\u8def\u7531\u3002"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"\u5e38\u898b\u932f\u8aa4\u8207\u6392\u9664",children:"\u5e38\u898b\u932f\u8aa4\u8207\u6392\u9664"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"406 Not Acceptable"}),"\uff1a\u8acb\u6c42 header \u7f3a\u5c11 ",(0,l.jsx)(n.code,{children:"Accept: text/event-stream"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"404 Handler not set"}),"\uff1a\u672a\u8a3b\u518a handler"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"422 Validation Error"}),"\uff1a\u8acb\u6c42\u683c\u5f0f\u6216\u696d\u52d9\u9a57\u8b49\u5931\u6557"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u6e2c\u8a66\u9801\u9762\u7121\u6cd5\u8f09\u5165"}),"\uff1a\u6aa2\u67e5 ",(0,l.jsx)(n.code,{children:"test_page.html"})," \u662f\u5426\u5b58\u5728\u65bc templates \u76ee\u9304"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"\u5be6\u7528\u5efa\u8b70",children:"\u5be6\u7528\u5efa\u8b70"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsxs)(n.strong,{children:["\u958b\u767c\u968e\u6bb5\u5efa\u8b70\u555f\u7528 ",(0,l.jsx)(n.code,{children:"debug_mode"})," \u8207 ",(0,l.jsx)(n.code,{children:"enable_test_page"}),"\uff0c\u4fbf\u65bc\u9664\u932f\u8207\u6e2c\u8a66\u3002"]})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u751f\u7522\u74b0\u5883\u8acb\u95dc\u9589\u6e2c\u8a66\u9801\u9762\uff0c\u907f\u514d\u8cc7\u8a0a\u5916\u6d29\u3002"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"\u81ea\u8a02\u9a57\u8b49\u5668\u6642\uff0c\u52d9\u5fc5\u547c\u53eb\u7236\u985e\u5225\u7684 validate \u4ee5\u4fdd\u8b49\u57fa\u672c\u9a57\u8b49\u4e0d\u88ab\u8df3\u904e\u3002"})}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"api-\u53c3\u8003",children:"API \u53c3\u8003"}),"\n",(0,l.jsx)(n.h3,{id:"sseserverconfig",children:"SSEServerConfig"}),"\n",(0,l.jsx)(n.p,{children:"\u914d\u7f6e\u985e\u5225\u63d0\u4f9b\u4e86\u8c50\u5bcc\u7684\u81ea\u5b9a\u7fa9\u9078\u9805\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'class SSEServerConfig:\n    # \u57fa\u672c\u914d\u7f6e\n    host: str = "0.0.0.0"\n    port: int = 8000\n    prefix: str = ""\n    chat_completions_path: str = "/chat/completions"\n    \n    # \u9a57\u8b49\u914d\u7f6e\n    allowed_models: List[str] = ["gpt-4o", "gpt-3.5-turbo", "sonar"]\n    max_message_length: int = 10000\n    max_messages_count: int = 100\n    \n    # \u958b\u767c\u8005\u9ad4\u9a57\u914d\u7f6e\n    debug_mode: bool = False\n    enable_request_logging: bool = True\n    enable_validation_details: bool = True\n    \n    # \u6548\u80fd\u914d\u7f6e\n    request_timeout: int = 30\n    max_concurrent_connections: int = 100\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u8acb\u6c42\u683c\u5f0f",children:"\u8acb\u6c42\u683c\u5f0f"}),"\n",(0,l.jsxs)(n.p,{children:["SSE Server \u63a5\u53d7\u7b26\u5408 ",(0,l.jsx)(n.code,{children:"ConversationSSERequest"})," \u683c\u5f0f\u7684\u8acb\u6c42\uff1a"]}),"\n",(0,l.jsx)(n.h4,{id:"conversationsserequest-\u6b04\u4f4d\u8aaa\u660e",children:"ConversationSSERequest \u6b04\u4f4d\u8aaa\u660e"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u6b04\u4f4d\u540d\u7a31"}),(0,l.jsx)(n.th,{children:"\u578b\u614b"}),(0,l.jsx)(n.th,{children:"\u5fc5\u586b"}),(0,l.jsx)(n.th,{children:"\u8aaa\u660e"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"model"})}),(0,l.jsx)(n.td,{children:"str"}),(0,l.jsx)(n.td,{children:"\u2714"}),(0,l.jsxs)(n.td,{children:["\u6307\u5b9a\u6a21\u578b\u540d\u7a31\uff0c\u4f8b\u5982 ",(0,l.jsx)(n.code,{children:'"gpt-4o"'}),"\u3001",(0,l.jsx)(n.code,{children:'"sonar"'})]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"messages"})}),(0,l.jsx)(n.td,{children:"List[Message]"}),(0,l.jsx)(n.td,{children:"\u2714"}),(0,l.jsxs)(n.td,{children:["\u5c0d\u8a71\u8a0a\u606f\u9663\u5217\uff0c\u6bcf\u5247\u8a0a\u606f\u9700\u5305\u542b ",(0,l.jsx)(n.code,{children:"role"})," \u8207 ",(0,l.jsx)(n.code,{children:"content"}),"\uff0c\u8a73\u898b\u4e0b\u65b9"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"stream"})}),(0,l.jsx)(n.td,{children:"bool"}),(0,l.jsx)(n.td,{children:"\u2714"}),(0,l.jsxs)(n.td,{children:["\u662f\u5426\u555f\u7528\u4e32\u6d41\uff0cSSE \u5fc5\u9808\u70ba ",(0,l.jsx)(n.code,{children:"true"})]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"clientId"})}),(0,l.jsx)(n.td,{children:"str"}),(0,l.jsx)(n.td,{}),(0,l.jsx)(n.td,{children:"\u5ba2\u6236\u7aef\u8b58\u5225\u78bc\uff08\u9078\u586b\uff0c\u524d\u7aef\u53ef\u81ea\u8a02\uff09"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"sessionId"})}),(0,l.jsx)(n.td,{children:"str"}),(0,l.jsx)(n.td,{children:"\u2714"}),(0,l.jsx)(n.td,{children:"\u5c0d\u8a71 session id\uff0c\u6a19\u8a18\u672c\u6b21\u5c0d\u8a71\u6240\u5c6c"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"temperature"})}),(0,l.jsx)(n.td,{children:"float"}),(0,l.jsx)(n.td,{}),(0,l.jsx)(n.td,{children:"\u56de\u61c9\u591a\u6a23\u6027\uff08\u9078\u586b\uff0c0~2\uff0c\u6108\u9ad8\u6108\u96a8\u6a5f\uff09"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"maxTokens"})}),(0,l.jsx)(n.td,{children:"int"}),(0,l.jsx)(n.td,{}),(0,l.jsx)(n.td,{children:"\u751f\u6210\u6700\u5927 token \u6578\uff08\u9078\u586b\uff09"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"tools"})}),(0,l.jsx)(n.td,{children:"List[Any]"}),(0,l.jsx)(n.td,{}),(0,l.jsx)(n.td,{children:"\u5de5\u5177\u5217\u8868\uff08\u9078\u586b\uff0cfunction calling \u7528\uff09"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"toolChoice"})}),(0,l.jsx)(n.td,{children:"Any"}),(0,l.jsx)(n.td,{}),(0,l.jsx)(n.td,{children:"\u5de5\u5177\u9078\u64c7\uff08\u9078\u586b\uff09"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"sourceLanguage"})}),(0,l.jsx)(n.td,{children:"str"}),(0,l.jsx)(n.td,{}),(0,l.jsx)(n.td,{children:"\u6e90\u8a9e\u8a00\uff08\u9078\u586b\uff0c\u7ffb\u8b6f\u4efb\u52d9\u7528\uff09"})]})]})]}),"\n",(0,l.jsx)(n.h4,{id:"message-\u6b04\u4f4d\u8aaa\u660e",children:"Message \u6b04\u4f4d\u8aaa\u660e"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u6b04\u4f4d\u540d\u7a31"}),(0,l.jsx)(n.th,{children:"\u578b\u614b"}),(0,l.jsx)(n.th,{children:"\u5fc5\u586b"}),(0,l.jsx)(n.th,{children:"\u8aaa\u660e"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"role"})}),(0,l.jsx)(n.td,{children:"str"}),(0,l.jsx)(n.td,{children:"\u2714"}),(0,l.jsxs)(n.td,{children:["\u8a0a\u606f\u89d2\u8272\uff0c\u5982 ",(0,l.jsx)(n.code,{children:'"system"'}),"\u3001",(0,l.jsx)(n.code,{children:'"user"'}),"\u3001",(0,l.jsx)(n.code,{children:'"assistant"'})]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"content"})}),(0,l.jsx)(n.td,{children:"str"}),(0,l.jsx)(n.td,{children:"\u2714"}),(0,l.jsx)(n.td,{children:"\u8a0a\u606f\u5167\u5bb9"})]})]})]}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u5099\u8a3b\uff1a"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:'\u6240\u6709\u6b04\u4f4d\u9810\u8a2d\u7981\u6b62\u984d\u5916\u6b04\u4f4d\uff08extra="forbid"\uff09\uff0c\u591a\u9918\u6b04\u4f4d\u6703\u9a57\u8b49\u5931\u6557\u3002'}),"\n",(0,l.jsxs)(n.li,{children:["\u6b04\u4f4d\u540d\u7a31\u652f\u63f4\u99dd\u5cf0\u5f0f\uff08\u5982 ",(0,l.jsx)(n.code,{children:"clientId"}),"\u3001",(0,l.jsx)(n.code,{children:"sessionId"}),"\u3001",(0,l.jsx)(n.code,{children:"maxTokens"}),"\uff09\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"\u7bc4\u4f8b-json",children:"\u7bc4\u4f8b JSON"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n    "model": "gpt-4o",\n    "messages": [\n        {"role": "system", "content": "You are a helpful assistant."},\n        {"role": "user", "content": "Hello!"}\n    ],\n    "stream": true,\n    "clientId": "client123",\n    "sessionId": "session-123",\n    "temperature": 0.7,\n    "maxTokens": 1000,\n    "tools": [],\n    "toolChoice": null,\n    "sourceLanguage": "en"\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u56de\u61c9\u683c\u5f0f",children:"\u56de\u61c9\u683c\u5f0f"}),"\n",(0,l.jsxs)(n.p,{children:["\u670d\u52d9\u5668\u56de\u50b3\u7b26\u5408 ",(0,l.jsx)(n.code,{children:"ConversationSSEResponse"})," \u683c\u5f0f\u7684 SSE \u4e8b\u4ef6\uff1a"]}),"\n",(0,l.jsx)(n.h4,{id:"conversationsseresponse-\u6b04\u4f4d\u8aaa\u660e",children:"ConversationSSEResponse \u6b04\u4f4d\u8aaa\u660e"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u6b04\u4f4d\u540d\u7a31"}),(0,l.jsx)(n.th,{children:"\u578b\u614b"}),(0,l.jsx)(n.th,{children:"\u5fc5\u586b"}),(0,l.jsx)(n.th,{children:"\u8aaa\u660e"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"id"})}),(0,l.jsx)(n.td,{children:"str"}),(0,l.jsx)(n.td,{children:"\u2714"}),(0,l.jsx)(n.td,{children:"\u552f\u4e00\u8b58\u5225\u78bc\uff08\u6bcf\u500b\u4e8b\u4ef6\u552f\u4e00\uff09"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"type"})}),(0,l.jsx)(n.td,{children:"str"}),(0,l.jsx)(n.td,{children:"\u2714"}),(0,l.jsxs)(n.td,{children:["\u8cc7\u6599\u985e\u578b\uff0c\u5982 ",(0,l.jsx)(n.code,{children:'"text"'}),"\u3001",(0,l.jsx)(n.code,{children:'"meta"'}),"\u3001",(0,l.jsx)(n.code,{children:'"done"'})]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"model"})}),(0,l.jsx)(n.td,{children:"str"}),(0,l.jsx)(n.td,{}),(0,l.jsx)(n.td,{children:"\u56de\u61c9\u7684\u6a21\u578b\u540d\u7a31\uff08\u9078\u586b\uff09"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"text"})}),(0,l.jsx)(n.td,{children:"str"}),(0,l.jsx)(n.td,{}),(0,l.jsxs)(n.td,{children:["\u672c\u6b21\u4e32\u6d41\u65b0\u6587\u672c\uff08\u9078\u586b\uff0c\u901a\u5e38 type \u70ba ",(0,l.jsx)(n.code,{children:'"text"'})," \u6642\u6709\u503c\uff09"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"progress"})}),(0,l.jsx)(n.td,{children:"str"}),(0,l.jsx)(n.td,{children:"\u2714"}),(0,l.jsxs)(n.td,{children:["\u9032\u5ea6\u72c0\u614b\uff0c",(0,l.jsx)(n.code,{children:'"IN_PROGRESS"'})," \u6216 ",(0,l.jsx)(n.code,{children:'"DONE"'})]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"context"})}),(0,l.jsx)(n.td,{children:"SSEContext"}),(0,l.jsx)(n.td,{}),(0,l.jsx)(n.td,{children:"\u4e0a\u4e0b\u6587\u8cc7\u8a0a\uff08\u9078\u586b\uff0c\u5305\u542b conversationId\u3001cursor \u7b49\uff09"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"metadata"})}),(0,l.jsx)(n.td,{children:"SSEResponseMetadata"}),(0,l.jsx)(n.td,{}),(0,l.jsx)(n.td,{children:"\u8f14\u52a9\u8cc7\u8a0a\uff08\u9078\u586b\uff0c\u5305\u542b searchResults\u3001attachments \u7b49\uff09"})]})]})]}),"\n",(0,l.jsx)(n.h4,{id:"ssecontext-\u6b04\u4f4d\u8aaa\u660e",children:"SSEContext \u6b04\u4f4d\u8aaa\u660e"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u6b04\u4f4d\u540d\u7a31"}),(0,l.jsx)(n.th,{children:"\u578b\u614b"}),(0,l.jsx)(n.th,{children:"\u5fc5\u586b"}),(0,l.jsx)(n.th,{children:"\u8aaa\u660e"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"conversationId"})}),(0,l.jsx)(n.td,{children:"str"}),(0,l.jsx)(n.td,{}),(0,l.jsx)(n.td,{children:"\u5c0d\u8a71 ID\uff08\u9078\u586b\uff09"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"cursor"})}),(0,l.jsx)(n.td,{children:"str"}),(0,l.jsx)(n.td,{}),(0,l.jsx)(n.td,{children:"\u6e38\u6a19\uff08\u9078\u586b\uff0c\u4e32\u6d41\u9032\u5ea6\u8ffd\u8e64\uff09"})]})]})]}),"\n",(0,l.jsx)(n.h4,{id:"sseresponsemetadata-\u6b04\u4f4d\u8aaa\u660e",children:"SSEResponseMetadata \u6b04\u4f4d\u8aaa\u660e"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u6b04\u4f4d\u540d\u7a31"}),(0,l.jsx)(n.th,{children:"\u578b\u614b"}),(0,l.jsx)(n.th,{children:"\u5fc5\u586b"}),(0,l.jsx)(n.th,{children:"\u8aaa\u660e"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"searchResults"})}),(0,l.jsx)(n.td,{children:"Any"}),(0,l.jsx)(n.td,{}),(0,l.jsx)(n.td,{children:"\u641c\u5c0b\u7d50\u679c\uff08\u9078\u586b\uff0c\u7d50\u69cb\u4f9d\u61c9\u7528\u800c\u5b9a\uff09"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"attachments"})}),(0,l.jsx)(n.td,{children:"Any"}),(0,l.jsx)(n.td,{}),(0,l.jsx)(n.td,{children:"\u9644\u4ef6\uff08\u9078\u586b\uff0c\u7d50\u69cb\u4f9d\u61c9\u7528\u800c\u5b9a\uff09"})]})]})]}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u5099\u8a3b\uff1a"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:'\u6240\u6709\u6b04\u4f4d\u9810\u8a2d\u7981\u6b62\u984d\u5916\u6b04\u4f4d\uff08extra="forbid"\uff09\uff0c\u591a\u9918\u6b04\u4f4d\u6703\u9a57\u8b49\u5931\u6557\u3002'}),"\n",(0,l.jsxs)(n.li,{children:["\u6b04\u4f4d\u540d\u7a31\u652f\u63f4\u99dd\u5cf0\u5f0f\uff08\u5982 ",(0,l.jsx)(n.code,{children:"conversationId"}),"\u3001",(0,l.jsx)(n.code,{children:"searchResults"}),"\uff09\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"progress"})," \u5fc5\u9808\u70ba ",(0,l.jsx)(n.code,{children:'"IN_PROGRESS"'})," \u6216 ",(0,l.jsx)(n.code,{children:'"DONE"'}),"\uff0c\u5426\u5247\u6703\u9a57\u8b49\u5931\u6557\u3002"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"\u7bc4\u4f8b-json-1",children:"\u7bc4\u4f8b JSON"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n    "id": "msg-1",\n    "type": "text",\n    "model": "gpt-4o",\n    "text": "Hello! How can I help you?",\n    "progress": "IN_PROGRESS",\n    "context": {\n        "conversationId": "conv-123",\n        "cursor": "cursor-abc"\n    },\n    "metadata": {\n        "searchResults": null,\n        "attachments": null\n    }\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"\u9a57\u8b49\u6a5f\u5236",children:"\u9a57\u8b49\u6a5f\u5236"}),"\n",(0,l.jsx)(n.h3,{id:"\u8f38\u5165\u9a57\u8b49",children:"\u8f38\u5165\u9a57\u8b49"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"HTTP Header \u9a57\u8b49"})," - \u5fc5\u9808\u5305\u542b ",(0,l.jsx)(n.code,{children:"Accept: text/event-stream"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"JSON \u683c\u5f0f\u9a57\u8b49"})," - \u78ba\u4fdd\u8acb\u6c42\u9ad4\u70ba\u6709\u6548\u7684 JSON"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Schema \u9a57\u8b49"})," - \u4f7f\u7528 Pydantic \u9a57\u8b49\u8acb\u6c42\u7b26\u5408 ",(0,l.jsx)(n.code,{children:"ConversationSSERequest"})," \u683c\u5f0f"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u696d\u52d9\u908f\u8f2f\u9a57\u8b49"})," - \u6aa2\u67e5\u6a21\u578b\u540d\u7a31\u3001\u8a0a\u606f\u7d50\u69cb\u3001\u9577\u5ea6\u9650\u5236\u7b49"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"\u8f38\u51fa\u9a57\u8b49",children:"\u8f38\u51fa\u9a57\u8b49"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u578b\u614b\u6aa2\u67e5"})," - \u78ba\u4fdd handler \u56de\u50b3 ",(0,l.jsx)(n.code,{children:"ConversationSSEResponse"})," \u7269\u4ef6"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u5fc5\u8981\u6b04\u4f4d\u6aa2\u67e5"})," - \u9a57\u8b49 ",(0,l.jsx)(n.code,{children:"id"}),"\u3001",(0,l.jsx)(n.code,{children:"type"}),"\u3001",(0,l.jsx)(n.code,{children:"progress"})," \u7b49\u5fc5\u8981\u6b04\u4f4d"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u9032\u5ea6\u72c0\u614b\u6aa2\u67e5"})," - \u78ba\u4fdd ",(0,l.jsx)(n.code,{children:"progress"})," \u70ba\u6709\u6548\u503c (",(0,l.jsx)(n.code,{children:"IN_PROGRESS"})," \u6216 ",(0,l.jsx)(n.code,{children:"DONE"}),")"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u932f\u8aa4\u8655\u7406",children:"\u932f\u8aa4\u8655\u7406"}),"\n",(0,l.jsx)(n.h3,{id:"http-\u932f\u8aa4\u78bc",children:"HTTP \u932f\u8aa4\u78bc"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"400"})," - \u8acb\u6c42\u683c\u5f0f\u932f\u8aa4\uff08\u7121\u6548 JSON\u3001\u7a7a\u8acb\u6c42\u7b49\uff09"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"406"})," - \u7f3a\u5c11 ",(0,l.jsx)(n.code,{children:"Accept: text/event-stream"})," header"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"422"})," - \u8acb\u6c42 schema \u9a57\u8b49\u5931\u6557"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"404"})," - Handler \u672a\u8a2d\u5b9a"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"sse-\u932f\u8aa4\u4e8b\u4ef6",children:"SSE \u932f\u8aa4\u4e8b\u4ef6"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'event: error\ndata: {"error": "Business validation failed", "details": "Unsupported model: invalid-model"}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u81ea\u5b9a\u7fa9\u7570\u5e38",children:"\u81ea\u5b9a\u7fa9\u7570\u5e38"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'from llmbrick.core.exceptions import ValidationException\n\n@server.handler \nasync def my_handler(request_data):\n    if some_condition:\n        raise ValidationException("Custom validation error")\n    # ...\n'})}),"\n",(0,l.jsx)(n.h2,{id:"\u958b\u767c\u8005\u4f7f\u7528\u6a21\u5f0f",children:"\u958b\u767c\u8005\u4f7f\u7528\u6a21\u5f0f"}),"\n",(0,l.jsx)(n.h3,{id:"1-\u57fa\u672c\u804a\u5929\u6a5f\u5668\u4eba",children:"1. \u57fa\u672c\u804a\u5929\u6a5f\u5668\u4eba"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'server = SSEServer()\n\n@server.handler\nasync def chat_handler(request_data):\n    # \u7c21\u55ae\u7684\u56de\u8072\u6a5f\u5668\u4eba\n    user_message = request_data["messages"][-1]["content"]\n    \n    yield ConversationSSEResponse(\n        id="response-1",\n        type="text",\n        text=f"You said: {user_message}",\n        progress="DONE"\n    )\n'})}),"\n",(0,l.jsx)(n.h3,{id:"2-\u6d41\u5f0f\u56de\u61c9",children:"2. \u6d41\u5f0f\u56de\u61c9"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'@server.handler\nasync def streaming_handler(request_data):\n    response_text = "This is a long response that will be streamed..."\n    \n    for i, char in enumerate(response_text):\n        progress = "DONE" if i == len(response_text) - 1 else "IN_PROGRESS"\n        \n        yield ConversationSSEResponse(\n            id=f"chunk-{i}",\n            type="text",\n            text=char,\n            progress=progress\n        )\n'})}),"\n",(0,l.jsx)(n.h3,{id:"3-\u6574\u5408\u5916\u90e8-llm",children:"3. \u6574\u5408\u5916\u90e8 LLM"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'import openai\n\n@server.handler\nasync def openai_handler(request_data):\n    # \u8f49\u63db\u70ba OpenAI \u683c\u5f0f\n    openai_messages = [\n        {"role": msg["role"], "content": msg["content"]} \n        for msg in request_data["messages"]\n    ]\n    \n    # \u8abf\u7528 OpenAI API\n    response = await openai.ChatCompletion.acreate(\n        model=request_data["model"],\n        messages=openai_messages,\n        stream=True\n    )\n    \n    async for chunk in response:\n        if chunk.choices[0].delta.content:\n            yield ConversationSSEResponse(\n                id=chunk.id,\n                type="text",\n                text=chunk.choices[0].delta.content,\n                progress="IN_PROGRESS"\n            )\n    \n    # \u7d50\u675f\u6a19\u8a18\n    yield ConversationSSEResponse(\n        id="final", \n        type="done",\n        progress="DONE"\n    )\n'})}),"\n",(0,l.jsx)(n.h2,{id:"\u5167\u5efa\u6e2c\u8a66\u9801\u9762",children:"\u5167\u5efa\u6e2c\u8a66\u9801\u9762"}),"\n",(0,l.jsxs)(n.p,{children:["SSE Server \u63d0\u4f9b\u4e86\u4e00\u500b\u958b\u767c\u8005\u53cb\u5584\u7684\u6e2c\u8a66\u9801\u9762\uff0c\u53ef\u900f\u904e ",(0,l.jsx)(n.code,{children:"enable_test_page"})," \u53c3\u6578\u555f\u7528\uff1a"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"server = SSEServer(enable_test_page=True)\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u6e2c\u8a66\u9801\u9762\u529f\u80fd\uff1a"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u5b8c\u6574\u7684\u8acb\u6c42\u914d\u7f6e"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u652f\u63f4\u6240\u6709 ConversationSSERequest \u6b04\u4f4d"}),"\n",(0,l.jsx)(n.li,{children:"\u52d5\u614b\u8a0a\u606f\u7ba1\u7406\uff08\u65b0\u589e/\u522a\u9664/\u91cd\u6392\u5e8f\uff09"}),"\n",(0,l.jsx)(n.li,{children:"\u5167\u5efa\u6b04\u4f4d\u8aaa\u660e\u548c\u985e\u578b\u63d0\u793a"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u4e32\u6d41\u8f38\u51fa\u8996\u89ba\u5316"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u56fa\u5b9a\u9ad8\u5ea6\u7684\u8f38\u51fa\u5340\u584a\uff0c\u81ea\u52d5\u6372\u52d5\u5230\u6700\u65b0\u8a0a\u606f"}),"\n",(0,l.jsxs)(n.li,{children:["\u6642\u9593\u6233\u8a18\u6a19\u8a18\uff08HH:MM",":SS",".mmm\uff09"]}),"\n",(0,l.jsxs)(n.li,{children:["\u4f9d\u8a0a\u606f\u985e\u578b\u986f\u793a\u4e0d\u540c\u984f\u8272\uff1a","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4e00\u822c\u8a0a\u606f\uff1a\u9810\u8a2d\u984f\u8272"}),"\n",(0,l.jsx)(n.li,{children:"\u932f\u8aa4\u8a0a\u606f\uff1a\u7d05\u8272\u80cc\u666f"}),"\n",(0,l.jsx)(n.li,{children:"Meta \u8a0a\u606f\uff1a\u85cd\u8272\u80cc\u666f"}),"\n",(0,l.jsx)(n.li,{children:"Done \u8a0a\u606f\uff1a\u7da0\u8272\u80cc\u666f"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u4f7f\u7528\u8005\u9ad4\u9a57\u512a\u5316"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u6df1\u8272/\u6dfa\u8272\u4e3b\u984c\u5207\u63db"}),"\n",(0,l.jsx)(n.li,{children:"\u652f\u63f4\u7cfb\u7d71\u4e3b\u984c\u504f\u597d"}),"\n",(0,l.jsx)(n.li,{children:"\u4e3b\u984c\u8a2d\u5b9a\u81ea\u52d5\u4fdd\u5b58"}),"\n",(0,l.jsx)(n.li,{children:"\u97ff\u61c9\u5f0f\u8a2d\u8a08\uff0c\u9069\u61c9\u4e0d\u540c\u87a2\u5e55\u5927\u5c0f"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u958b\u767c\u8005\u5de5\u5177"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"API \u6587\u4ef6\u548c\u7bc4\u4f8b"}),"\n",(0,l.jsx)(n.li,{children:"\u8acb\u6c42/\u56de\u61c9\u683c\u5f0f\u8aaa\u660e"}),"\n",(0,l.jsx)(n.li,{children:"\u6b04\u4f4d\u63cf\u8ff0\u8207\u898f\u7bc4"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"SSE Test Page",src:s(2743).A+"",width:"1284",height:"1319"})}),"\n",(0,l.jsx)(n.p,{children:"\u8981\u8a2a\u554f\u6e2c\u8a66\u9801\u9762\uff0c\u53ea\u9700\u5728\u700f\u89bd\u5668\u4e2d\u958b\u555f\u4f3a\u670d\u5668\u6839\u8def\u5f91\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"http://localhost:8000/\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u6e2c\u8a66\u4f60\u7684\u61c9\u7528",children:"\u6e2c\u8a66\u4f60\u7684\u61c9\u7528"}),"\n",(0,l.jsx)(n.h3,{id:"\u4f7f\u7528-curl-\u6e2c\u8a66",children:"\u4f7f\u7528 curl \u6e2c\u8a66"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# \u6e2c\u8a66\u57fa\u672c SSE \u8acb\u6c42\ncurl -X POST http://localhost:8000/chat/completions \\\n  -H "Content-Type: application/json" \\\n  -H "Accept: text/event-stream" \\\n  -d \'{\n    "model": "gpt-4o",\n    "messages": [\n      {"role": "user", "content": "Hello!"}\n    ],\n    "stream": true,\n    "sessionId": "test-session-123"\n  }\'\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u6e2c\u8a66\u4f60\u7684-handler",children:"\u6e2c\u8a66\u4f60\u7684 Handler"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'import pytest\nfrom fastapi.testclient import TestClient\nfrom llmbrick.servers.sse.server import SSEServer\nfrom llmbrick.protocols.models.http.conversation import ConversationSSEResponse\nfrom llmbrick.core.error_codes import ErrorCodes\n\ndef test_my_handler():\n    server = SSEServer()\n    \n    @server.handler\n    async def my_handler(request_data):\n        yield ConversationSSEResponse(\n            id="test-1",\n            type="text",\n            text="Test response",\n            progress="DONE"\n        )\n    \n    # \u82e5\u5728\u81ea\u5b9a\u7fa9\u9a57\u8b49\u5668\u4e2d\u4f7f\u7528 ValidationException\uff0c\u8acb\u52a0\u4e0a import\n    from llmbrick.core.exceptions import ValidationException\n    \n    client = TestClient(server.fastapi_app)\n    \n    response = client.post(\n        "/chat/completions",\n        json={\n            "model": "gpt-4o",\n            "messages": [{"role": "user", "content": "test"}],\n            "stream": True,\n            "sessionId": "test-session"\n        },\n        headers={"accept": "text/event-stream"}\n    )\n    \n    assert response.status_code == ErrorCodes.SUCCESS\n    assert "Test response" in response.content.decode()\n'})}),"\n",(0,l.jsx)(n.h3,{id:"javascript-\u5ba2\u6236\u7aef\u6e2c\u8a66",children:"JavaScript \u5ba2\u6236\u7aef\u6e2c\u8a66"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"// \u6e2c\u8a66 SSE \u9023\u63a5\nconst eventSource = new EventSource('/chat/completions');\n\n// \u767c\u9001 POST \u8acb\u6c42\uff08\u9700\u8981\u4f7f\u7528 fetch + EventSource \u7d44\u5408\uff09\nfetch('/chat/completions', {\n  method: 'POST',\n  headers: {\n    'Content-Type': 'application/json',\n    'Accept': 'text/event-stream'\n  },\n  body: JSON.stringify({\n    model: 'gpt-4o',\n    messages: [\n      { role: 'user', content: 'Hello!' }\n    ],\n    stream: true,\n    sessionId: 'test-session-123'\n  })\n}).then(response => {\n  const reader = response.body.getReader();\n  \n  function readStream() {\n    return reader.read().then(({ done, value }) => {\n      if (done) return;\n      \n      const chunk = new TextDecoder().decode(value);\n      console.log('Received:', chunk);\n      \n      return readStream();\n    });\n  }\n  \n  return readStream();\n});\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u6545\u969c\u6392\u9664",children:"\u6545\u969c\u6392\u9664"}),"\n",(0,l.jsx)(n.h3,{id:"\u5e38\u898b\u554f\u984c",children:"\u5e38\u898b\u554f\u984c"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"406 \u932f\u8aa4"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u78ba\u4fdd\u8acb\u6c42 header \u5305\u542b ",(0,l.jsx)(n.code,{children:"Accept: text/event-stream"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"422 \u932f\u8aa4"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u6aa2\u67e5\u8acb\u6c42\u683c\u5f0f\u662f\u5426\u7b26\u5408 ",(0,l.jsx)(n.code,{children:"ConversationSSERequest"})," schema"]}),"\n",(0,l.jsxs)(n.li,{children:["\u78ba\u4fdd ",(0,l.jsx)(n.code,{children:"sessionId"})," \u5fc5\u8981\u6b04\u4f4d\u5b58\u5728"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u696d\u52d9\u9a57\u8b49\u5931\u6557"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u6aa2\u67e5\u6a21\u578b\u540d\u7a31\u662f\u5426\u5728 ",(0,l.jsx)(n.code,{children:"allowed_models"})," \u6e05\u55ae\u4e2d"]}),"\n",(0,l.jsx)(n.li,{children:"\u78ba\u8a8d\u8a0a\u606f\u7d50\u69cb\u7b26\u5408\u8981\u6c42\uff08\u6700\u5f8c\u4e00\u5247\u70ba user \u8a0a\u606f\u7b49\uff09"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Handler \u7570\u5e38"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u555f\u7528 ",(0,l.jsx)(n.code,{children:"debug_mode=True"})," \u7372\u53d6\u8a73\u7d30\u932f\u8aa4\u8a0a\u606f"]}),"\n",(0,l.jsxs)(n.li,{children:["\u6aa2\u67e5 handler \u662f\u5426\u6b63\u78ba\u56de\u50b3 ",(0,l.jsx)(n.code,{children:"ConversationSSEResponse"})," \u7269\u4ef6"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"\u9664\u932f\u6a21\u5f0f",children:"\u9664\u932f\u6a21\u5f0f"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"config = SSEServerConfig(\n    debug_mode=True,\n    enable_request_logging=True,\n    enable_validation_details=True\n)\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u555f\u7528\u9664\u932f\u6a21\u5f0f\u5f8c\uff0c\u4f60\u5c07\u7372\u5f97\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u8a73\u7d30\u7684\u932f\u8aa4\u8a0a\u606f"}),"\n",(0,l.jsx)(n.li,{children:"\u5b8c\u6574\u7684\u8acb\u6c42\u65e5\u8a8c"}),"\n",(0,l.jsx)(n.li,{children:"\u7570\u5e38\u5806\u758a\u8ffd\u8e64"}),"\n",(0,l.jsx)(n.li,{children:"\u66f4\u591a\u9a57\u8b49\u8a73\u60c5"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u6700\u4f73\u5be6\u8e10",children:"\u6700\u4f73\u5be6\u8e10"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u4f7f\u7528\u914d\u7f6e\u985e\u5225"})," - \u4fbf\u65bc\u7ba1\u7406\u548c\u7dad\u8b77"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u9069\u7576\u7684\u932f\u8aa4\u8655\u7406"})," - \u5728 handler \u4e2d\u6355\u7372\u4e26\u8655\u7406\u7570\u5e38"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u578b\u614b\u5b89\u5168"})," - \u59cb\u7d42\u56de\u50b3\u6b63\u78ba\u7684 ",(0,l.jsx)(n.code,{children:"ConversationSSEResponse"})," \u7269\u4ef6"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u65e5\u8a8c\u8a18\u9304"})," - \u555f\u7528\u8acb\u6c42\u65e5\u8a8c\u4ee5\u4fbf\u76e3\u63a7\u548c\u9664\u932f"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u6e2c\u8a66\u8986\u84cb"})," - \u70ba\u4f60\u7684 handler \u7de8\u5beb\u6e2c\u8a66\u78ba\u4fdd\u529f\u80fd\u6b63\u5e38"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u9032\u968e\u529f\u80fd",children:"\u9032\u968e\u529f\u80fd"}),"\n",(0,l.jsx)(n.h3,{id:"\u81ea\u5b9a\u7fa9\u9a57\u8b49\u5668",children:"\u81ea\u5b9a\u7fa9\u9a57\u8b49\u5668"}),"\n",(0,l.jsx)(n.p,{children:"\u4f60\u53ef\u4ee5\u5efa\u7acb\u81ea\u5b9a\u7fa9\u9a57\u8b49\u5668\u4f86\u5be6\u73fe\u7279\u6b8a\u7684\u696d\u52d9\u908f\u8f2f\u9a57\u8b49\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'from llmbrick.servers.sse.server import SSEServer\nfrom llmbrick.servers.sse.validators import ConversationSSERequestValidator\nfrom llmbrick.core.exceptions import ValidationException\n\nclass CustomValidator(ConversationSSERequestValidator):\n    @staticmethod\n    def validate(request, allowed_models=None, max_message_length=10000, max_messages_count=100):\n        # \u5148\u57f7\u884c\u57fa\u672c\u9a57\u8b49\n        super(CustomValidator, CustomValidator).validate(\n            request, allowed_models, max_message_length, max_messages_count\n        )\n        \n        # \u81ea\u5b9a\u7fa9\u9a57\u8b49\u908f\u8f2f\n        if request.temperature and request.temperature > 2.0:\n            raise ValidationException("Temperature too high")\n        \n        # \u6aa2\u67e5\u7279\u5b9a\u7684\u6a21\u578b\u9650\u5236\n        if request.model == "gpt-4o" and len(request.messages) > 50:\n            raise ValidationException("GPT-4o model limited to 50 messages")\n        \n        # \u6aa2\u67e5\u7279\u6b8a\u95dc\u9375\u5b57\n        for msg in request.messages:\n            if "banned_word" in msg.content.lower():\n                raise ValidationException("Content contains banned words")\n\n# \u4f7f\u7528\u81ea\u5b9a\u7fa9\u9a57\u8b49\u5668\ncustom_validator = CustomValidator()\nserver = SSEServer(custom_validator=custom_validator)\n\n@server.handler\nasync def my_handler(request_data):\n    # \u5230\u9019\u88e1\u7684\u8acb\u6c42\u90fd\u5df2\u7d93\u901a\u904e\u81ea\u5b9a\u7fa9\u9a57\u8b49\n    yield ConversationSSEResponse(\n        id="response-1",\n        type="text",\n        text="Validated request processed",\n        progress="DONE"\n    )\n\nserver.run()\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u66f4\u7c21\u55ae\u7684\u9a57\u8b49\u5668\u64f4\u5c55",children:"\u66f4\u7c21\u55ae\u7684\u9a57\u8b49\u5668\u64f4\u5c55"}),"\n",(0,l.jsx)(n.p,{children:"\u5982\u679c\u4f60\u53ea\u9700\u8981\u6dfb\u52a0\u4e00\u4e9b\u7c21\u55ae\u7684\u9a57\u8b49\u898f\u5247\uff0c\u53ef\u4ee5\u9019\u6a23\u505a\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"from llmbrick.servers.sse.validators import ConversationSSERequestValidator\nfrom llmbrick.core.exceptions import ValidationException\n\nclass MyValidator(ConversationSSERequestValidator):\n    @staticmethod\n    def validate(request, allowed_models=None, max_message_length=10000, max_messages_count=100):\n        # \u57f7\u884c\u9810\u8a2d\u9a57\u8b49\n        ConversationSSERequestValidator.validate(\n            request, allowed_models, max_message_length, max_messages_count\n        )\n        \n        # \u6dfb\u52a0\u4f60\u7684\u9a57\u8b49\u908f\u8f2f\n        if hasattr(request, 'client_id') and request.client_id:\n            if not request.client_id.startswith('app_'):\n                raise ValidationException(\"Client ID must start with 'app_'\")\n\n# \u4f7f\u7528\u65b9\u5f0f\nserver = SSEServer(custom_validator=MyValidator())\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u4e2d\u9593\u4ef6\u652f\u63f4",children:"\u4e2d\u9593\u4ef6\u652f\u63f4"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'from fastapi import Request\n\nserver = SSEServer()\n\n@server.app.middleware("http")\nasync def custom_middleware(request: Request, call_next):\n    # \u81ea\u5b9a\u7fa9\u4e2d\u9593\u4ef6\u908f\u8f2f\n    response = await call_next(request)\n    return response\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u9019\u4efd\u6307\u5357\u6db5\u84cb\u4e86 SSE Server \u7684\u4e3b\u8981\u529f\u80fd\u548c\u4f7f\u7528\u65b9\u5f0f\u3002\u5982\u6709\u5176\u4ed6\u554f\u984c\uff0c\u8acb\u53c3\u8003\u7bc4\u4f8b\u4ee3\u78bc\u6216\u63d0\u4ea4 Issue\u3002"})]})}function a(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}},2743:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/sse_server_test-4f227fa8fc554eb90466b4e64902b421.png"},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>t});var r=s(6540);const l={},d=r.createContext(l);function i(e){const n=r.useContext(d);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),r.createElement(d.Provider,{value:n},e.children)}}}]);