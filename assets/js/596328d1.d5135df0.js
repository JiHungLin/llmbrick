"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[543],{2709:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>o,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"documents/bricks/llm_brick_guide/openai_llm_brick_guide","title":"OpenAI GPT Brick","description":"\u76ee\u9304","source":"@site/docs/documents/bricks/llm_brick_guide/openai_llm_brick_guide.md","sourceDirName":"documents/bricks/llm_brick_guide","slug":"/documents/bricks/llm_brick_guide/openai_llm_brick_guide","permalink":"/llmbrick/docs/documents/bricks/llm_brick_guide/openai_llm_brick_guide","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"documentsSidebar","previous":{"title":"LLMBrick","permalink":"/llmbrick/docs/documents/bricks/llm_brick_guide/"},"next":{"title":"RectifyBrick","permalink":"/llmbrick/docs/documents/bricks/rectify_brick_guide"}}');var s=r(4848),t=r(8453);const l={},c="OpenAI GPT Brick",o={},d=[{value:"\u76ee\u9304",id:"\u76ee\u9304",level:2},{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:2},{value:"\u5b89\u88dd\u8207\u914d\u7f6e",id:"\u5b89\u88dd\u8207\u914d\u7f6e",level:2},{value:"\u74b0\u5883\u8b8a\u6578\u8a2d\u7f6e",id:"\u74b0\u5883\u8b8a\u6578\u8a2d\u7f6e",level:3},{value:"\u4f9d\u8cf4\u5b89\u88dd",id:"\u4f9d\u8cf4\u5b89\u88dd",level:3},{value:"\u5feb\u901f\u958b\u59cb",id:"\u5feb\u901f\u958b\u59cb",level:2},{value:"\u57fa\u672c\u4f7f\u7528\u7bc4\u4f8b",id:"\u57fa\u672c\u4f7f\u7528\u7bc4\u4f8b",level:3},{value:"\u4e32\u6d41\u8f38\u51fa\u7bc4\u4f8b",id:"\u4e32\u6d41\u8f38\u51fa\u7bc4\u4f8b",level:3},{value:"SSE Server \u6574\u5408\u7bc4\u4f8b",id:"sse-server-\u6574\u5408\u7bc4\u4f8b",level:3}];function a(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"openai-gpt-brick",children:"OpenAI GPT Brick"})}),"\n",(0,s.jsx)(e.h2,{id:"\u76ee\u9304",children:"\u76ee\u9304"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"#%E6%A6%82%E8%BF%B0",children:"\u6982\u8ff0"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"#%E5%AE%89%E8%A3%9D%E8%88%87%E9%85%8D%E7%BD%AE",children:"\u5b89\u88dd\u8207\u914d\u7f6e"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"#%E5%BF%AB%E9%80%9F%E9%96%8B%E5%A7%8B",children:"\u5feb\u901f\u958b\u59cb"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"#api-%E8%AA%AA%E6%98%8E",children:"API \u8aaa\u660e"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"#%E6%9C%80%E4%BD%B3%E5%AF%A6%E8%B8%90",children:"\u6700\u4f73\u5be6\u8e10"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"#%E9%8C%AF%E8%AA%A4%E8%99%95%E7%90%86",children:"\u932f\u8aa4\u8655\u7406"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"#%E5%B8%B8%E8%A6%8B%E5%95%8F%E9%A1%8C",children:"\u5e38\u898b\u554f\u984c"})}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u6982\u8ff0",children:"\u6982\u8ff0"}),"\n",(0,s.jsx)(e.p,{children:"OpenAI GPT Brick \u662f\u57fa\u65bc LLMBrick \u6846\u67b6\u5be6\u73fe\u7684 OpenAI GPT \u6574\u5408\u5143\u4ef6\uff0c\u652f\u63f4 GPT-3.5\u3001GPT-4 \u7b49\u6a21\u578b\uff0c\u4e26\u63d0\u4f9b\u55ae\u6b21\u8acb\u6c42\u8207\u4e32\u6d41\u8f38\u51fa\u529f\u80fd\u3002\u5176\u8a2d\u8a08\u9075\u5faa LLMBrick \u7684\u7d71\u4e00\u63a5\u53e3\uff0c\u652f\u63f4\u672c\u5730\u8207 gRPC \u9060\u7aef\u8abf\u7528\u3002"}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u5b89\u88dd\u8207\u914d\u7f6e",children:"\u5b89\u88dd\u8207\u914d\u7f6e"}),"\n",(0,s.jsx)(e.h3,{id:"\u74b0\u5883\u8b8a\u6578\u8a2d\u7f6e",children:"\u74b0\u5883\u8b8a\u6578\u8a2d\u7f6e"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# .env file\nOPENAI_API_KEY=your_api_key_here\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u4f9d\u8cf4\u5b89\u88dd",children:"\u4f9d\u8cf4\u5b89\u88dd"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"pip install openai  # OpenAI Python client\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"\u5feb\u901f\u958b\u59cb",children:"\u5feb\u901f\u958b\u59cb"}),"\n",(0,s.jsx)(e.h3,{id:"\u57fa\u672c\u4f7f\u7528\u7bc4\u4f8b",children:"\u57fa\u672c\u4f7f\u7528\u7bc4\u4f8b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'import asyncio\nfrom llmbrick.bricks.llm.openai_llm import OpenAIGPTBrick\nfrom llmbrick.protocols.models.bricks.llm_types import LLMRequest, Context\n\nasync def main():\n    # \u5275\u5efa OpenAI GPT Brick \u5be6\u4f8b\n    brick = OpenAIGPTBrick(\n        default_prompt="",\n        model_id="gpt-3.5-turbo"  # \u53ef\u9078: gpt-4\n    )\n    \n    # \u6e96\u5099\u8acb\u6c42\n    request = LLMRequest(\n        prompt="Tell me a joke",\n        temperature=0.7,\n        max_tokens=100,\n        context=[]  # \u53ef\u9078: \u6dfb\u52a0\u5c0d\u8a71\u4e0a\u4e0b\u6587\n    )\n    \n    # \u57f7\u884c\u8acb\u6c42\n    response = await brick.run_unary(request)\n    print(response.text)\n\nasyncio.run(main())\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u4e32\u6d41\u8f38\u51fa\u7bc4\u4f8b",children:"\u4e32\u6d41\u8f38\u51fa\u7bc4\u4f8b"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'async def stream_example():\n    brick = OpenAIGPTBrick(model_id="gpt-3.5-turbo")\n    request = LLMRequest(prompt="Write a story")\n    \n    async for chunk in brick.run_output_streaming(request):\n        if not chunk.is_final:\n            print(chunk.text, end="", flush=True)\n\nasyncio.run(stream_example())\n'})}),"\n",(0,s.jsx)(e.h3,{id:"sse-server-\u6574\u5408\u7bc4\u4f8b",children:"SSE Server \u6574\u5408\u7bc4\u4f8b"}),"\n",(0,s.jsx)(e.p,{children:"\u66f4\u5b8c\u6574\u7684\u6574\u5408\u7bc4\u4f8b\uff0c\u5305\u542b SSE \u670d\u52d9\u5668\u548c\u6e2c\u8a66\u9801\u9762\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:'from llmbrick.servers.sse.server import SSEServer\nfrom llmbrick.servers.sse.config import SSEServerConfig\nfrom llmbrick.bricks.llm.openai_llm import OpenAIGPTBrick\nfrom llmbrick.protocols.models.http.conversation import ConversationSSERequest, ConversationSSEResponse\n\n# \u5275\u5efa SSE \u670d\u52d9\u5668\nconfig = SSEServerConfig(\n    host="127.0.0.1",\n    port=8000,\n    debug_mode=True,\n    allowed_models=["gpt-4o", "gpt-3.5-turbo"],\n    enable_test_page=True  # \u555f\u7528\u6e2c\u8a66\u9801\u9762\n)\n\nserver = SSEServer(config=config)\nllm = OpenAIGPTBrick(model_id="gpt-4o")\n\n# \u8655\u7406\u804a\u5929\u8acb\u6c42\n@server.handler\nasync def handle_chat(request: ConversationSSERequest):\n    # \u9996\u5148\u767c\u9001\u958b\u59cb\u4e8b\u4ef6\n    yield ConversationSSEResponse(\n        id="start",\n        type="start",\n        progress="IN_PROGRESS"\n    )\n    \n    # \u6e96\u5099 LLM \u8acb\u6c42\u4e26\u4e32\u6d41\u56de\u61c9\n    llm_request = LLMRequest(\n        model_id=request.model,\n        prompt=request.messages[-1].content,\n        context=[Context(role=msg.role, content=msg.content)\n                for msg in request.messages[:-1]]\n    )\n    \n    try:\n        async for chunk in llm.run_output_streaming(llm_request):\n            if chunk.text:\n                yield ConversationSSEResponse(\n                    id=f"chunk-{time.time()}",\n                    type="text",\n                    text=chunk.text,\n                    progress="IN_PROGRESS"\n                )\n    except Exception as e:\n        yield ConversationSSEResponse(\n            id="error",\n            type="error",\n            text=str(e),\n            progress="DONE"\n        )\n    \n    # \u767c\u9001\u5b8c\u6210\u4e8b\u4ef6\n    yield ConversationSSEResponse(\n        id="done",\n        type="done",\n        progress="DONE"\n    )\n\n# \u555f\u52d5\u670d\u52d9\u5668\nserver.run()\n'})}),"\n",(0,s.jsxs)(e.p,{children:["\u5b8c\u6574\u7684\u5be6\u4f5c\u7bc4\u4f8b\u53ef\u4ee5\u5728 ",(0,s.jsx)(e.a,{href:"https://github.com/JiHungLin/llmbrick/tree/main/examples/openai_chatbot/openai_chatbot.py",children:(0,s.jsx)(e.code,{children:"openai_chatbot/openai_chatbot.py"})})," \u4e2d\u627e\u5230\uff0c\u5305\u542b\uff1a"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"SSE \u670d\u52d9\u5668\u6574\u5408"}),"\n",(0,s.jsx)(e.li,{children:"\u81ea\u52d5\u8a9e\u8a00\u5075\u6e2c"}),"\n",(0,s.jsx)(e.li,{children:"\u4e32\u6d41\u8207\u7d2f\u7a4d\u56de\u61c9\u986f\u793a"}),"\n",(0,s.jsx)(e.li,{children:"\u932f\u8aa4\u8655\u7406"}),"\n",(0,s.jsx)(e.li,{children:"\u6e2c\u8a66\u9801\u9762"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:["\u8a2a\u554f ",(0,s.jsx)(e.a,{href:"http://127.0.0.1:8000/",children:"http://127.0.0.1:8000/"})," \u53ef\u4ee5\u4f7f\u7528\u5167\u5efa\u7684\u6e2c\u8a66\u9801\u9762\uff1a"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u652f\u63f4\u4e32\u6d41\u8f38\u51fa\u986f\u793a"}),"\n",(0,s.jsx)(e.li,{children:"\u5373\u6642\u7d2f\u7a4d\u56de\u61c9"}),"\n",(0,s.jsx)(e.li,{children:"\u81ea\u52d5\u5075\u6e2c\u7cfb\u7d71\u8a9e\u8a00"}),"\n",(0,s.jsx)(e.li,{children:"\u6df1\u8272/\u6dfa\u8272\u4e3b\u984c"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'\n---\n\n## API \u8aaa\u660e\n\n### \u5efa\u69cb\u5b50\u53c3\u6578\n\n- `default_prompt (str)`: \u9810\u8a2d\u63d0\u793a\u8a5e\n- `model_id (str)`: OpenAI \u6a21\u578b ID\uff0c\u652f\u63f4 "gpt-3.5-turbo"\u3001"gpt-4" \u548c "gpt-4o"\n- `api_key (Optional[str])`: OpenAI API \u91d1\u9470\uff0c\u82e5\u672a\u63d0\u4f9b\u5247\u5f9e\u74b0\u5883\u8b8a\u6578\u8b80\u53d6\n\n### \u652f\u63f4\u7684\u6a21\u578b\n\n- `gpt-3.5-turbo`: \u9810\u8a2d\u6a21\u578b\uff0c\u9069\u5408\u4e00\u822c\u5c0d\u8a71\u8207\u4efb\u52d9\n- `gpt-4`: \u9032\u968e\u6a21\u578b\uff0c\u9069\u5408\u8907\u96dc\u4efb\u52d9\u8207\u63a8\u7406\n- `gpt-4o`: \u9032\u968e\u6a21\u578b\u7684\u6700\u65b0\u512a\u5316\u7248\u672c\n\n### \u8acb\u6c42\u53c3\u6578\u8aaa\u660e\n\n\u4f7f\u7528 `LLMRequest` \u985e\u578b\uff0c\u91cd\u8981\u6b04\u4f4d\u5305\u62ec\uff1a\n- `prompt (str)`: \u4e3b\u8981\u63d0\u793a\u8a5e\n- `context (List[Context])`: \u5c0d\u8a71\u6b77\u53f2\u4e0a\u4e0b\u6587\n- `temperature (float)`: \u751f\u6210\u96a8\u6a5f\u6027\uff0c\u9810\u8a2d 0.7\n- `max_tokens (int)`: \u6700\u5927\u751f\u6210\u9577\u5ea6\n\n---\n\n## \u6700\u4f73\u5be6\u8e10\n\n1. **API \u91d1\u9470\u7ba1\u7406**\n   - \u4f7f\u7528\u74b0\u5883\u8b8a\u6578\u7ba1\u7406 API \u91d1\u9470\n   - \u907f\u514d\u5728\u7a0b\u5f0f\u78bc\u4e2d\u786c\u7de8\u78bc\u91d1\u9470\n\n2. **\u932f\u8aa4\u8655\u7406**\n   - \u59a5\u5584\u8655\u7406 API \u9650\u6d41\u8207\u932f\u8aa4\n   - \u4f7f\u7528 try-except \u6355\u6349\u53ef\u80fd\u7684\u7570\u5e38\n\n3. **\u8cc7\u6e90\u7ba1\u7406**\n   - \u53ca\u6642\u95dc\u9589\u4e0d\u9700\u8981\u7684\u9023\u63a5\n   - \u4f7f\u7528\u4e32\u6d41\u6a21\u5f0f\u8655\u7406\u9577\u56de\u61c9\n\n4. **\u6027\u80fd\u512a\u5316**\n   - \u9069\u7576\u8a2d\u7f6e max_tokens \u907f\u514d\u904e\u5ea6\u751f\u6210\n   - \u6839\u64da\u9700\u6c42\u9078\u64c7\u9069\u7576\u7684\u6a21\u578b\n\n---\n\n## \u932f\u8aa4\u8655\u7406\n\n\u5e38\u898b\u932f\u8aa4\u78bc\u8207\u8655\u7406\u65b9\u5f0f\uff1a\n- `ValueError`: API \u91d1\u9470\u672a\u8a2d\u7f6e\n- `ErrorDetail(code=1)`: API \u8abf\u7528\u5931\u6557\n- `ErrorDetail(code=0)`: \u6210\u529f\n\n---\n\n## \u5e38\u898b\u554f\u984c\n\n### Q1: \u5982\u4f55\u5207\u63db\u4e0d\u540c\u7684 GPT \u6a21\u578b\uff1f\nA: \u5728\u5efa\u69cb\u6642\u6307\u5b9a model_id \u53c3\u6578\uff0c\u6216\u5728\u8acb\u6c42\u6642\u8a2d\u7f6e model_id\u3002\n\n### Q2: API \u91d1\u9470\u672a\u8a2d\u7f6e\u600e\u9ebc\u8fa6\uff1f\nA: \u78ba\u8a8d\u74b0\u5883\u8b8a\u6578 OPENAI_API_KEY \u5df2\u6b63\u78ba\u8a2d\u7f6e\uff0c\u6216\u5728\u5efa\u69cb\u6642\u63d0\u4f9b api_key \u53c3\u6578\u3002\n\n### Q3: \u5982\u4f55\u8655\u7406 API \u9650\u6d41\uff1f\nA: \u5be6\u4f5c\u91cd\u8a66\u6a5f\u5236\uff0c\u6216\u4f7f\u7528\u6846\u67b6\u7684\u932f\u8aa4\u8655\u7406\u6a5f\u5236\u3002\n\n### Q4: \u4e32\u6d41\u8f38\u51fa\u65b7\u958b\u5982\u4f55\u8655\u7406\uff1f\nA: \u6aa2\u67e5\u6bcf\u500b\u97ff\u61c9\u584a\u7684 error \u6b04\u4f4d\uff0c\u5be6\u4f5c\u91cd\u9023\u908f\u8f2f\u3002\n'})})]})}function p(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(a,{...n})}):a(n)}},8453:(n,e,r)=>{r.d(e,{R:()=>l,x:()=>c});var i=r(6540);const s={},t=i.createContext(s);function l(n){const e=i.useContext(t);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:l(n.components),i.createElement(t.Provider,{value:e},n.children)}}}]);